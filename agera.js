"use strict";(()=>{var E={apiUrl:"https://utils-api.vercel.app/api/",counterPath:"counter/",jsDelivrUrl:"https://data.jsdelivr.com/v1/packages/gh/ageraplattformen/agera.js/resolved?specifier=latest"},R={method:"POST",headers:{"Content-Type":"application/json"},critical:!0};function H(t){document.querySelectorAll("[data-profundo-client]").forEach(n=>{n.addEventListener("click",async()=>{let r=n.dataset.activitytypeId||"",i=n.dataset.classificationId||"",p=n.dataset.profundoText||"",c=_(void 0,{client:n.dataset.profundoClient||"not_provided",client_url:n.dataset.profundoUrl||"not_provided",country_code:n.dataset.countryCode||"",name:{name_id:Number(t)},register_id:n.dataset.registerId||"",campaign_id:Number(n.dataset.campaignId)||void 0,activity:{...r?{activitytype_id:r}:{activitytype_id:""},...i?{classification_id:i}:{},...p?{shortText:p}:{},shorttext:n.dataset.profundoText||""}});await a(c)})});async function a(n){try{let r=await fetch(n.url,{method:n.method,headers:n.headers,body:n.body});return r.ok?await r.json():void 0}catch(r){console.log("P error: ",r);return}}}function N(t,e){t.data&&e.push(t.data)}function _(t,e){let n=t?b(t,{"given-name":"firstname","family-name":"lastname",email:"email",tel:"mobile","street-adress":"address","postal-code":"zip",country:"country_id"}):void 0,r=e==null?void 0:e.name.name_id;n||(n=new FormData);let i=(e==null?void 0:e.activity.shorttext)||(t==null?void 0:t.dataset.profundoText),p=(t==null?void 0:t.dataset.registerId)||(e==null?void 0:e.register_id),c=(t==null?void 0:t.dataset.campaignId)||(e==null?void 0:e.campaign_id),u=(t==null?void 0:t.dataset.classificationId)||(e==null?void 0:e.activity.classification_id)||"SI",m=n&&{...Object.fromEntries(n)},l=(t==null?void 0:t.getAttribute("data-country-code"))||(e==null?void 0:e.country_code)||"";r&&(m.name_id=Number(r));let w={...T.campaign?{text1:T.campaign}:"",...T.source?{text2:T.source}:"",...T.medium?{text3:T.medium}:"",...T.content?{text4:T.content}:""};return{...R,critical:!r,url:new URL("profundo/",E.apiUrl).toString(),body:JSON.stringify({client:(t==null?void 0:t.dataset.client)||(e==null?void 0:e.client)||"not_provided",client_url:(t==null?void 0:t.getAttribute("action"))||(e==null?void 0:e.client_url)||"",...l?{country_code:l}:{},referrer:window.location.href,body:{name:m,...p?{register_id:p}:{},...c?{campaign_id:c}:{},activity:{...r?{}:{...w},...i?{shorttext:i}:{},activitytype_id:(t==null?void 0:t.dataset.activitytypeId)||(e==null?void 0:e.activity.activitytype_id)||"UN",...u?{classification_id:u}:{}}}})}}function b(t,e){let a=new FormData;for(let[n,r]of new FormData(t))e.hasOwnProperty(n)?a.append(e[n],r):a.append(n,r);return a}var P=new URLSearchParams(window.location.search);function ne(){function t(a){let n=[...P.keys()].find(r=>r.toLowerCase().includes(a));return n&&P.get(n)||""}return{source:t("source").toLowerCase(),campaign:t("campaign").toLowerCase(),medium:t("medium").toLowerCase(),content:t("content").toLowerCase()}}var T=ne(),v=Array.from(P,([t,e])=>`${t.toLowerCase()}: ${e.toLowerCase()}`).join(", ");var k,O,I,j,S={thisUrl:new URL(window.location.href),wfSiteId:(O=(k=document.querySelector("html"))==null?void 0:k.dataset.wfSite)!=null?O:"0000",wfUrl:new URL((j=(I=document.querySelector("html"))==null?void 0:I.dataset.wfSite)!=null?j:"0000","https://webflow.com/api/v1/form/")},x={method:"POST",headers:{"Content-Type":"application/json"},critical:!0},q={webFlow(t){var n;let e=new FormData(t);e.append("UTM",v);let a=new URLSearchParams({name:(n=t==null?void 0:t.getAttribute("name"))!=null?n:"form",source:window.location.href});for(let r of e.entries()){let i=`fields[${r[0]}]`;a.append(i,r[1])}return{...x,url:S.wfUrl.href,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()}},mailChimp(t){var r;let a=b(t,{"given-name":"FNAME","family-name":"LNAME",email:"EMAIL",tel:"PHONE","street-adress":"ADDRESS","postal-code":"POSTALCODE","adress-level2":"REGION",country:"COUNTRY"}),n=new URLSearchParams;for(let[i,p]of a.entries())(typeof p=="string"||typeof p=="number")&&n.append(i,p.toString());return n.append("UTM",v),{...x,url:((r=t.getAttribute("action"))==null?void 0:r.replace("post?","post-json?"))+"&c=?",headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"jsonp",body:n.toString()}},zapier(t){return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({[t.getAttribute("name")||"form"]:Object.fromEntries(new FormData(t)),source:S.thisUrl.hostname+S.thisUrl.pathname,time:new Date().toISOString(),UTM:v})}},amnesty(t){let e=(t==null?void 0:t.getAttribute("data-country-code"))||"";return{...x,url:new URL("amnesty/",E.apiUrl).toString(),body:JSON.stringify({form:{...Object.fromEntries(new FormData(t)),action_id:t.dataset.actionId||"9999",sign_method:t.dataset.signMethod||"agera-default"},UTM:v,site_id:S.wfSiteId,...e?{country_code:e}:{}})}},actionNetwork(t){let e=new FormData(t),a=[];for(let[n,r]of e.entries())n.startsWith("tags")&&a.push(r);return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({person:{given_name:e.get("given-name"),family_name:e.get("family-name"),email_addresses:[{address:e.get("email")}],phone_numbers:[{number:e.get("tel")||""}],postal_addresses:[{postal_code:e.get("postal-code")||"",address_lines:e.get("street-address")||"",region:e.get("adress-level2")||"",country:e.get("country")||""}]},add_tags:[...a],"action_network:referrer_data":{source:T.source?T.source.toString():"",website:S.thisUrl.hostname+S.thisUrl.pathname}})}},profundo:_};function re(t){var l,w,h,f;let e={thisUrl:new URL(window.location.href),wfSiteId:(w=(l=document.querySelector("html"))==null?void 0:l.dataset.wfSite)!=null?w:"0000",wfUrl:new URL((f=(h=document.querySelector("html"))==null?void 0:h.dataset.wfSite)!=null?f:"0000","https://webflow.com/api/v1/form/"),redirect:t.getAttribute("redirect")||null,addUtm:!!t.dataset.redirectUtm||!0,utmSource:new URLSearchParams(window.location.search).get("utm_source")||new URLSearchParams(window.location.search).get("source"),submitButton:t.querySelector('input[type="submit"]'),submitText:"",niceUtms:Array.from(new URLSearchParams(window.location.search),([s,o])=>`${s}: ${o}`).join(", ")};e.submitText=e.submitButton&&e.submitButton.value||"";function a(s,o){let d=new FormData(o);return{method:"POST",headers:{"Content-Type":"application/json"},critical:!1,url:new URL(E.counterPath+s,E.apiUrl).toString(),body:JSON.stringify({form:"default",site_id:e.wfSiteId,last_person:d.get("given-name")||"",form_url:e.thisUrl})}}function n(s,o,d){let g=s.parentNode,y=g==null?void 0:g.querySelector(".w-form-done"),L=g==null?void 0:g.querySelector(".w-form-fail");o?(y&&(y.style.display="block"),L&&(L.style.display="none"),d&&r()):(y&&(y.style.display="none"),L&&(L.style.display="block"),e.submitButton&&(e.submitButton.value=e.submitText))}function r(){if(e.redirect)if(e.addUtm&&e.redirect){let s=new URL(e.redirect,e.thisUrl),o=new URLSearchParams(window.location.search);s.searchParams.forEach((g,y)=>{o.has(y)||o.set(y,g)});let d=s.origin+s.pathname+(o.toString()?"?"+o.toString():"");window.location.href=d}else window.location.href=e.redirect;else console.warn("No redirect defined")}async function i(s){return new Promise((o,d)=>{$.ajax({url:s.url,type:s.method,data:s.body,dataType:"jsonp",success:g=>{o(g)},error:(g,y,L)=>{d(L)}})})}async function p(s){if(s.dataType==="jsonp")return i(s);try{let o=await fetch(s.url,{method:s.method,headers:s.headers,body:s.body});if(!o.ok)throw new Error(`Error fetching ${s.url}: ${o.statusText}`);return o.json()}catch(o){throw console.error("An error occurred:",o),o}}function c(s){let o=[];s.forEach(g=>{if(g.status==="fulfilled"&&g.value){let y=g.value;N(y,o)}});let d=o.reduce((g,y)=>({...g,...y}),{});localStorage.setItem("crm_data",JSON.stringify(d))}async function u(s,o){try{let d=await Promise.allSettled(s.map(y=>p(y))),g=!1;d.forEach((y,L)=>{y.status==="rejected"&&s[L].critical&&(g=!0)}),g?n(o,!1,!1):(c(d),n(o,!0,!0))}catch(d){console.error("Error in Promise.allSettled:",d),n(o,!1,!1)}}async function m(s){s.addEventListener("submit",async function(o){var F;o.preventDefault(),o.stopPropagation(),e.submitButton&&(e.submitButton.value=e.submitButton.dataset.wait||e.submitButton.value);let d=[],g={webflow:"webFlow",actionnetwork:"actionNetwork",mailchimp:"mailChimp",zapier:"zapier",amnesty:"amnesty",profundo:"profundo"},y=((F=s.dataset.crm)==null?void 0:F.toLowerCase())||"webflow",L=s.dataset.counterUpdate;if(y&&g.hasOwnProperty(y)){let te=g[y];d.push(q[te](s))}L&&L!=="default"&&d.push(a(L,s)),d.length>0&&await u(d,s)})}return{handleForm:m}}function V(){let t=document.querySelectorAll("[data-crm]");for(let e of t)re(e).handleForm(e)}var U=class{constructor(){this.counters=new Map}async getCounter(e){if(this.counters.has(e))return this.counters.get(e);let a=new URL(E.counterPath+e,E.apiUrl),n=(async()=>{try{let i=await fetch(a);return i.ok?await i.json():void 0}catch{return}})();this.counters.set(e,n);let r=await n;return this.counters.delete(e),r}},M=new U;async function B(){try{let t=await fetch(E.jsDelivrUrl);return t.ok?`v${(await t.json()).version}`:"latest"}catch{return"latest"}}function oe(){function t(c,u){return c>=u?100:Math.round(c/u*100)}function e(c){let u={350:50,500:100,2e3:250,5e3:500,2e4:2500,5e4:5e3,1e5:1e4,2e5:25e3,5e5:5e4,1e6:1e5},m=25e4,w=Object.keys(u).map(Number).find(f=>f>=c),h=w?u[w]:m;return Math.ceil(c*1.05/h)*h}function a(c,u){return c*1.05<u.target||!u.autoTarget?u.target:e(c)}function n(c,u,m){c.style.width=t(u,m)+"%"}function r(c,u,m){try{let l=new Intl.NumberFormat(m.locale,m.notation).format(u);c.textContent=l}catch{m.notation.useGrouping=!1,m.notation.notation="standard";let l=new Intl.NumberFormat(void 0,m.notation).format(u);c.textContent=l}}function i(c,u,m){u>=m.hideBelow&&(c.style.opacity="1")}async function p(c){var s;let u=c.dataset.counterName||"default",m={target:parseInt(c.dataset.counterTarget||"0",10),hideBelow:parseInt(c.dataset.counterHideBelow||"0"),autoTarget:!!c.dataset.counterAutoTarget||!0,locale:c.dataset.counterLocale||document.documentElement.lang||"undefined",notation:{notation:((s=c.dataset.counterNotation)==null?void 0:s.toLowerCase())||"standard",useGrouping:!0}},l;if(u.toLowerCase()==="default")l=125;else{let o=await M.getCounter(u);o?l=o.count:l=0}if(c.classList.contains("counter-current-value"))r(c,l,m),i(c,l,m);else{let o=c.querySelectorAll(".counter-current-value");for(let d of o)r(d,l,m),i(d,l,m)}let w=a(l,m),h=c.querySelectorAll(".counter-target-value");for(let o of h)r(o,w,m),i(o,l,m);let f=c.querySelectorAll(".counterbar-limiter");for(let o of f)n(o,l,w);i(c,l,m)}return{processCounterElement:p}}function J(){let t=`
      .counter-target-value,
      .counter-current-value,
      .counter_container {
          opacity: 0;
          transition: opacity 0.7s;
      }
  `,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}function z(){let t=document.querySelectorAll("[data-counter-name]"),e=oe();for(let a of t)e.processCounterElement(a)}var D=(t,e=!0)=>t.cloneNode(e);function A(t){t&&t.classList.contains("cloak")&&t.classList.remove("cloak")}function K(){{let t=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: 0;
      padding-top: 0;
      padding-bottom: 0;
		}`,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}}function G(){var c,u;let t=document.querySelectorAll("[data-counter-name]"),a=(u=(c=Array.from(t).find(m=>m.dataset.counterLocale))==null?void 0:c.dataset.counterLocale)!=null?u:document.documentElement.lang||"en";a.toLowerCase()==="none"&&(a=document.documentElement.lang||"en");function n(m,l){let w=D(l),h=w.querySelector('[data-template="last-person-name"]'),f=w.querySelector('[data-template="last-person-time"]');return h&&f&&(h.innerText=m.name,f.innerText=r(m.date,a)),w}function r(m,l){let w=new Date,h=new Date(m),f=new Date(h.getTime()-h.getTimezoneOffset()*6e4),s=Math.floor((w.getTime()-f.getTime())/1e3),o=new Intl.RelativeTimeFormat(l,{numeric:"auto"});if(s<60)return o.format(-s,"second");let d=Math.floor(s/60);if(d<60)return o.format(-d,"minute");let g=Math.floor(s/3600);if(g<12)return o.format(-g,"hour");let y=Math.floor(s/86400);return o.format(-y,"day")}function i(m){let l=m.last_person.names;return l.reverse(),l.filter((h,f,s)=>s.findIndex(o=>o.name===h.name)===f)}async function p(m,l){let w=l.querySelector('[data-template="last-person"]');if(!w)return;let h=w.parentElement;w.remove();let f=await M.getCounter(m);if(!f||!f.last_person||!f.last_person.names||f.last_person.names.length<2){h==null||h.remove();return}let o=i(f).map(d=>n(d,w));o.length>0&&h&&(A(h),h.append(...o)),o.forEach(d=>{setTimeout(function(){A(d)},100)})}t.forEach(m=>{let l=m.dataset.counterName||"default";p(l,m)})}function C(t){let e=JSON.parse(localStorage.getItem(t)||"{}");return Object.entries(e)}function W(){function t(i){let p=C("forwardedform");function c(){let f=localStorage.getItem("crm_data");return f?(localStorage.removeItem("crm_data"),JSON.parse(f)):(localStorage.removeItem("crm_data"),null)}let u=c();u&&u.name_id&&(H(u.name_id),p.push(["name_id",u.name_id.toString()]));function m(f){let s=Array.from(new URLSearchParams(window.location.search),([o,d])=>`${o}: ${d}`).join(", ");return f.find(([o])=>o==="utm")||f.push(["utm",s]),f}let l=m(p);function w(f){f.forEach(([s,o])=>{let d=document.createTextNode(o).textContent,g=`<input type="hidden" id="${s}" name="${s}" value="${d}">`;i.insertAdjacentHTML("afterbegin",g)})}w(l);function h(f){let s="",o=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];f.forEach(([g,y])=>{o.includes(g.toLowerCase())&&(s=y)});let d=document.querySelectorAll("[data-insert-name]");d.length>0&&s!==""&&a(d,s)}h(l)}function e(i){let p=new URLSearchParams(window.location.search),c=Array.from(p,([w,h])=>`${w}: ${h}`),u=i.getAttribute("redirect"),m=u+(u!=null&&u.includes("?")?"&":"?")+p.toString();i.setAttribute("redirect",m),i.setAttribute("data-redirect",m),i.addEventListener("change",()=>{l(i)}),i.addEventListener("input",()=>{l(i)});function l(w){let h=new FormData(w),f=c.join(", ");h.set("utm",f),localStorage.setItem("forwardedform",JSON.stringify(Object.fromEntries(h)))}}function a(i,p){let c={"no-space":p,"leading-space":"&nbsp;"+p,"trailing-space":p+"&nbsp;","double-space":"&nbsp;"+p+"&nbsp;"};i.forEach(u=>{let m=u.getAttribute("data-insert-name")||"leading-space";c.hasOwnProperty(m)&&(u.innerHTML=c[m])})}let n=document.querySelectorAll("[data-crm]");n.length>0&&n.forEach(function(i){e(i)});let r=document.querySelectorAll('[data-load-petition="true"]');r.length>0&&r.forEach(function(i){t(i)})}async function Y(){let t=document.querySelectorAll("[data-js-version]");if(t.length<1)return;let e=document.querySelector('script[src$="agera.js"]'),a="";if(e){let{src:n}=e,r=n.match(/@([^/]+)/);if(r){let[,i]=r;a=i,a.toLowerCase().includes("latest")&&(a=await B())}}a!==""&&t.forEach(n=>{n.innerText=a})}var X="data-insert-name";function ae(t){let e="",a=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];t.forEach(([r,i])=>{a.includes(r.toLowerCase())&&(e=i)});let n=document.querySelectorAll(`[${X}]`);n.length>0&&e!==""&&se(n,e)}function se(t,e){let a={"no-space":e,"leading-space":"&nbsp;"+e,"trailing-space":e+"&nbsp;","double-space":"&nbsp;"+e+"&nbsp;"};t.forEach(n=>{let r=n.getAttribute(X)||"leading-space";a.hasOwnProperty(r)&&(n.innerHTML=a[r])})}function Q(){let t=C("forwardedform");ae(t)}function Z(){let t=new URLSearchParams(window.location.search);document.querySelectorAll("[data-redirect]").forEach(a=>{let n=a.getAttribute("data-redirect");try{if(n){let r=new URL(n,document.baseURI),i=new URL(r.toString()),p=i.searchParams;t.forEach((c,u)=>{p.has(u)||p.set(u,c)}),a.setAttribute("data-redirect",i.toString())}}catch(r){console.error("An error occurred:",r)}})}function ee(){let t=[document.documentElement.lang||"en","en"];document.querySelectorAll("[data-insert-time]").forEach(n=>{n.innerText=ie(n,t)}),document.querySelectorAll("[data-remaining-days-to]").forEach(n=>{n.innerText=ce(n,t)})}function ie(t,e){let a=new Date,n=t.getAttribute("data-insert-time"),r="";if((n==null?void 0:n.toLowerCase())==="year")r=a.getFullYear().toString();else if((n==null?void 0:n.toLowerCase())==="month")r=(a.getMonth()+1).toString();else if((n==null?void 0:n.toLowerCase())==="day")r=a.getDate().toString();else if((n==null?void 0:n.toLowerCase())==="date")r=a.toLocaleDateString(e);else if((n==null?void 0:n.toLowerCase())==="datetime")r=a.toLocaleString(e);else if((n==null?void 0:n.toLowerCase())==="time")r=a.toLocaleTimeString(e);else return"";return r}function ce(t,e){let a=new Date,n=t.getAttribute("data-remaining-days-to");try{if(n){let r=new Date(n),i=Math.round((r.getTime()-a.getTime())/(1e3*60*60*24));return new Intl.RelativeTimeFormat(e,{numeric:"auto"}).format(i,"day")}}catch(r){console.error("remainingDays error:",r)}return""}function ue(){J(),K(),document.addEventListener("DOMContentLoaded",()=>{W(),z(),V(),G(),Q(),ee(),Z(),Y()})}window.agera||(window.agera=!0,ue());})();
