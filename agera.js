"use strict";(()=>{var U="https://utils-api.vercel.app/api/counter/";async function T(u){let t=new URL(u,U);try{let y=await fetch(t);return y.ok?await y.json():void 0}catch{return}}function A(){let u="https://utils-api.vercel.app/api/counter/";function t(n,a){return n>=a?100:Math.round(n/a*100)}function y(n){let a={350:50,500:100,2e3:250,5e3:500,2e4:2500,5e4:5e3,1e5:1e4,2e5:25e3,5e5:5e4,1e6:1e5},r=25e4,c=Object.keys(a).map(Number).find(L=>L>=n),g=c?a[c]:r;return Math.ceil(n*1.05/g)*g}function i(n,a){return n*1.05<a.target||!a.autoTarget?a.target:y(n)}function h(n,a,r){n.style.width=t(a,r)+"%"}function w(n,a,r){try{let s=new Intl.NumberFormat(r.locale,r.notation).format(a);n.textContent=s}catch{r.notation.useGrouping=!1,r.notation.notation="standard";let s=new Intl.NumberFormat(void 0,r.notation).format(a);n.textContent=s}}function f(n,a,r){a>=r.hideBelow&&(n.style.opacity="1")}async function p(n){var b;let a=n.dataset.counterName||"default",r={target:parseInt(n.dataset.counterTarget||"0",10),hideBelow:parseInt(n.dataset.counterHideBelow||"0"),autoTarget:!!n.dataset.counterAutoTarget||!0,locale:n.dataset.counterLocale||document.documentElement.lang||"undefined",notation:{notation:((b=n.dataset.counterNotation)==null?void 0:b.toLowerCase())||"standard",useGrouping:!0}},s;if(a.toLowerCase()==="default")s=125;else{let e=await T(a);e?s=e.count:s=0}if(n.classList.contains("counter-current-value"))w(n,s,r),f(n,s,r);else{let e=n.querySelectorAll(".counter-current-value");for(let o of e)w(o,s,r),f(o,s,r)}let c=i(s,r),g=n.querySelectorAll(".counter-target-value");for(let e of g)w(e,c,r),f(e,s,r);let L=n.querySelectorAll(".counterbar-limiter");for(let e of L)h(e,s,c);f(n,s,r)}return{processCounterElement:p}}(function(){{let t=`
        .counter-target-value,
        .counter-current-value,
        .counter_container {
            opacity: 0;
            transition: opacity 0.7s;
        }
    `,y=document.createElement("style");y.textContent=t,document.head.appendChild(y)}document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelectorAll("[data-counter-name]"),y=A();for(let i of t)y.processCounterElement(i)})})();{let u=function(i,h){let w=new URLSearchParams(window.location.search).toString();i.querySelectorAll("input[data-redirect]").forEach(r=>{let s=r.getAttribute("data-redirect"),c=s+(s!=null&&s.includes("?")?"&":"?")+w.toString();r.setAttribute("data-redirect",c)});let p="",n=["first_name","given_name","fname","first","f-name","first-name","given","given-name","firstname","givenname"];h.forEach(([r,s])=>{let c=document.createTextNode(s).textContent,g=`<input type="hidden" id="${r}" name="${r}" value="${c}">`;i.insertAdjacentHTML("afterbegin",g),n.includes(r.toLowerCase())&&(p=s)});let a=document.querySelectorAll("[data-insert-name]");a.length>0&&p!==""&&y(a,p)},t=function(i){let h=new URLSearchParams(window.location.search),w=Array.from(h,([a,r])=>`${a}: ${r}`);localStorage.removeItem("multistepforward");let f=i.getAttribute("redirect"),p=f+(f!=null&&f.includes("?")?"&":"?")+h.toString();i.setAttribute("redirect",p),i.setAttribute("data-redirect",p),i.addEventListener("change",()=>{n(i)}),i.addEventListener("input",()=>{n(i)});function n(a){let r=new FormData(a),s=w.join(", ");r.set("utm",s),localStorage.setItem("forwardedform",JSON.stringify(Object.fromEntries(r)))}},y=function(i,h){let w={"no-space":h,"leading-space":"&nbsp;"+h,"trailing-space":h+"&nbsp;","double-space":"&nbsp;"+h+"&nbsp;"};i.forEach(f=>{let p=f.getAttribute("data-insert-name")||"leading-space";w.hasOwnProperty(p)&&(f.innerHTML=w[p])})};O=u,R=t,k=y,document.addEventListener("DOMContentLoaded",function(){let i=document.querySelectorAll("[data-crm]"),h=document.querySelectorAll('[data-load-petition="true"]');i.length>0&&i.forEach(function(w){t(w)}),h.length>0&&localStorage!==null&&h.forEach(function(w){if(localStorage.hasOwnProperty("forwardedform")){let f=JSON.parse(localStorage.getItem("forwardedform")||"{}");u(w,Object.entries(f)),localStorage.removeItem("forwardedform")}})})}var O,R,k;function S(u){u.classList.contains("cloak")&&u.classList.remove("cloak")}function C(){{let u=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: auto;
		}`,t=document.createElement("style");t.textContent=u,document.head.appendChild(t)}}function N(u){var c,g,L,b;let t={thisUrl:new URL(window.location.href),wfSiteId:(g=(c=document.querySelector("html"))==null?void 0:c.dataset.wfSite)!=null?g:"0000",wfUrl:new URL((b=(L=document.querySelector("html"))==null?void 0:L.dataset.wfSite)!=null?b:"0000","https://webflow.com/api/v1/form/"),backendUrl:"https://utils-api.vercel.app",counterApiPath:"api/counter/",niceUtms:Array.from(new URLSearchParams(window.location.search),([e,o])=>`${e}: ${o}`).join(", "),redirect:u.getAttribute("redirect")||null,endpoint:u.getAttribute("action")||null,addUtm:!!u.dataset.redirectUtm||!0,utmSource:new URLSearchParams(window.location.search).get("utm_source")||new URLSearchParams(window.location.search).get("source"),submitButton:u.querySelector('input[type="submit"]'),submitText:""};t.submitText=t.submitButton&&t.submitButton.value||"";function y(e,o){let d=new FormData;for(let[l,m]of new FormData(e))o.hasOwnProperty(l)?d.append(o[l],m):d.append(l,m);return d}let i={url:t.endpoint||"",method:"POST",headers:{"Content-Type":"application/json"},critical:!0},h={webFlow(e){var l;let o=new FormData(e);o.append("UTM",t.niceUtms);let d=new URLSearchParams({name:(l=e==null?void 0:e.getAttribute("name"))!=null?l:"form",source:window.location.href});for(let m of o.entries()){let E=`fields[${m[0]}]`;d.append(E,m[1])}return{...i,url:t.wfUrl.href,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:d.toString()}},mailChimp(e){var m;let d=y(e,{given_name:"FNAME",family_name:"LNAME",email:"EMAIL",tel:"PHONE",street_adress:"ADDRESS",postal_code:"POSTALCODE",adress_level2:"REGION",country:"COUNTRY"}),l=new URLSearchParams(d);return l.append("UTM",t.niceUtms),{...i,url:((m=t.endpoint)==null?void 0:m.replace("post?","post-json?"))+"&c=?",headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"jsonp",body:l.toString()}},zapier(e){return{...i,body:JSON.stringify({[e.getAttribute("name")||"form"]:Object.fromEntries(new FormData(e)),source:t.thisUrl.hostname+t.thisUrl.pathname,time:new Date().toISOString(),UTM:t.niceUtms})}},amnesty(e){return{...i,url:new URL("/api/amnesty",t.backendUrl).toString(),body:JSON.stringify({form:{...Object.fromEntries(new FormData(e)),action_id:e.dataset.actionId||"9999",sign_method:e.dataset.signMethod||"agera-default"},UTM:t.niceUtms,site_id:t.wfSiteId})}},actionNetwork(e){let o=new FormData(e);return{...i,body:JSON.stringify({person:{given_name:o.get("given-name"),family_name:o.get("family-name"),email_addresses:[{address:o.get("email")}],phone_numbers:[{number:o.get("tel")||""}],postal_addresses:[{postal_code:o.get("postal-code")||"",address_lines:o.get("street-address")||"",region:o.get("adress-level2")||"",country:o.get("country")||""}]},add_tags:[o.getAll("tags")||""],"action_network:referrer_data":{source:t.utmSource?t.utmSource.toString():"",website:t.thisUrl.hostname+t.thisUrl.pathname}})}}};function w(e,o){let d=new FormData(o);return{...i,critical:!1,url:new URL(t.counterApiPath+e,t.backendUrl).toString(),body:JSON.stringify({form:"default",site_id:t.wfSiteId,last_person:d.get("given-name")||"",source:t.thisUrl})}}function f(e,o,d){let l=e.parentNode,m=l==null?void 0:l.querySelector(".w-form-done"),E=l==null?void 0:l.querySelector(".w-form-fail");o?(m&&(m.style.display="block"),E&&(E.style.display="none"),d&&p()):(m&&(m.style.display="none"),E&&(E.style.display="block"),t.submitButton&&(t.submitButton.value=t.submitText))}function p(){if(t.redirect)if(t.addUtm&&t.redirect){let e=new URL(t.redirect,t.thisUrl),o=new URLSearchParams(window.location.search);e.searchParams.forEach((l,m)=>{o.has(m)||o.set(m,l)});let d=e.origin+e.pathname+(o.toString()?"?"+o.toString():"");window.location.href=d}else window.location.href=t.redirect;else console.warn("No redirect defined")}async function n(e){return await $.ajax({url:e.url,type:e.method,data:e.body,dataType:e.dataType})}async function a(e){let o;if(e.dataType==="jsonp"?o=await n(e):o=await fetch(e.url,{method:e.method,headers:e.headers,body:e.body}),!o.ok)throw new Error(`Error fetching ${e.url}: ${o.statusText}`);return o.json()}async function r(e,o){try{let d=await Promise.allSettled(e.map(m=>a(m))),l=!1;d.forEach((m,E)=>{m.status==="rejected"&&e[E].critical&&(l=!0)}),l?f(o,!1,!1):f(o,!0,!0)}catch(d){console.error("Error in Promise.allSettled:",d),f(o,!1,!1)}}async function s(e){e.addEventListener("submit",async function(o){var x;o.preventDefault(),o.stopPropagation(),t.submitButton&&(t.submitButton.value=t.submitButton.dataset.wait||"Wait...");let d=[],l={webflow:"webFlow",actionnetwork:"actionNetwork",mailchimp:"mailChimp",zapier:"zapier",amnesty:"amnesty"},m=((x=e.dataset.crm)==null?void 0:x.toLowerCase())||"webflow",E=e.dataset.counterUpdate;if(m&&l.hasOwnProperty(m)){let H=l[m];d.push(h[H](e))}E&&E!=="default"&&d.push(w(E,e)),d.length>0&&await r(d,e)})}return{handleForm:s}}function v(){let u=document.querySelectorAll("[data-crm]");for(let t of u)N(t).handleForm(t)}var M=(u,t=!0)=>u.cloneNode(t);function F(){var w,f;let u=document.querySelectorAll("[data-counter-name]"),t={locale:((w=u[0])==null?void 0:w.dataset.counterLocale)||document.documentElement.lang||"en",counterName:((f=u[0])==null?void 0:f.dataset.counterName)||"default"};function y(p,n){let a=M(n),r=a.querySelector('[data-template="last-person-name"]'),s=a.querySelector('[data-template="last-person-time"]');return r&&s&&(r.innerText=p.name,s.innerText=i(p.date,t.locale)),a}function i(p,n){let a=new Date,r=new Date(p),s=new Date(r.getTime()-r.getTimezoneOffset()*6e4),c=Math.floor((a.getTime()-s.getTime())/1e3),g=new Intl.RelativeTimeFormat(n,{numeric:"auto"});if(c<60)return g.format(-c,"second");let L=Math.floor(c/60);if(L<60)return g.format(-L,"minute");let b=Math.floor(c/3600);if(b<12)return g.format(-b,"hour");let e=Math.floor(c/86400);return g.format(-e,"day")}function h(p){let n=p.last_person.names;return n.reverse(),n.filter((r,s,c)=>c.findIndex(g=>g.name===r.name)===s)}(async function(){let n=document.querySelector('[data-template="last-person"]');if(!n)return;let a=n.parentElement;n.remove();let r=await T(t.counterName);if(!r){a==null||a.remove();return}let c=h(r).map(g=>y(g,n));c.length>0&&a&&(S(a),a.append(...c)),c.forEach(g=>{setTimeout(function(){S(g)},100)})})()}window.agera||C();document.addEventListener("DOMContentLoaded",()=>{window.agera||(window.agera=!0,v(),F())});})();
