"use strict";(()=>{var E={apiUrl:"https://utils-api.vercel.app/api/",counterPath:"counter/",jsDelivrUrl:"https://data.jsdelivr.com/v1/packages/gh/ageraplattformen/agera.js/resolved?specifier=latest"},R={method:"POST",headers:{"Content-Type":"application/json"},critical:!0};function H(t){document.querySelectorAll("[data-profundo-client]").forEach(n=>{n.addEventListener("click",async()=>{let r=n.dataset.activitytypeId||"",i=n.dataset.classificationId||"",p=n.dataset.profundoText||"",c=_(void 0,{client:n.dataset.profundoClient||"not_provided",client_url:n.dataset.profundoUrl||"not_provided",country_code:n.dataset.countryCode||"",name:{name_id:Number(t)},register_id:n.dataset.registerId||"",campaign_id:Number(n.dataset.campaignId)||void 0,activity:{...r?{activitytype_id:r}:{activitytype_id:""},...i?{classification_id:i}:{},...p?{shortText:p}:{},shorttext:n.dataset.profundoText||""}});await s(c)})});async function s(n){try{let r=await fetch(n.url,{method:n.method,headers:n.headers,body:n.body});return r.ok?await r.json():void 0}catch(r){console.log("P error: ",r);return}}}function N(t,e){t.data&&e.push(t.data)}function _(t,e){let n=t?b(t,{"given-name":"firstname","family-name":"lastname",email:"email",tel:"mobile","street-adress":"address","postal-code":"zip",country:"country_id"}):void 0,r=e==null?void 0:e.name.name_id;n||(n=new FormData);let i=[];for(let[f,a]of n.entries())if(f.startsWith("infotype")){let o=parseInt(a);isNaN(o)||i.push(o),n.delete(f)}let p=(t==null?void 0:t.getAttribute("data-country-code"))||(e==null?void 0:e.country_code)||"";!(n!=null&&n.get("country"))&&p&&n.append("country",p);let c=(e==null?void 0:e.activity.shorttext)||(t==null?void 0:t.dataset.profundoText),m=(t==null?void 0:t.dataset.registerId)||(e==null?void 0:e.register_id),u=(t==null?void 0:t.dataset.campaignId)||(e==null?void 0:e.campaign_id),l=(t==null?void 0:t.dataset.classificationId)||(e==null?void 0:e.activity.classification_id)||"SI",w=n&&{...Object.fromEntries(n)};r&&(w.name_id=Number(r));let g={...T.campaign?{text1:T.campaign}:"",...T.source?{text2:T.source}:"",...T.medium?{text3:T.medium}:"",...T.content?{text4:T.content}:""};return{...R,critical:!r,url:new URL("profundo/",E.apiUrl).toString(),body:JSON.stringify({client:(t==null?void 0:t.dataset.client)||(e==null?void 0:e.client)||"not_provided",client_url:(t==null?void 0:t.getAttribute("action"))||(e==null?void 0:e.client_url)||"",...p?{country_code:p}:{},referrer:window.location.href,body:{name:w,...m?{register_id:m}:{},...u?{campaign_id:u}:{},...i?{infotype_id:i[0]}:{},activity:{...r?{}:{...g},...c?{shorttext:c}:{},activitytype_id:(t==null?void 0:t.dataset.activitytypeId)||(e==null?void 0:e.activity.activitytype_id)||"UN",...l?{classification_id:l}:{}}}})}}function b(t,e){let s=new FormData;for(let[n,r]of new FormData(t))e.hasOwnProperty(n)?s.append(e[n],r):s.append(n,r);return s}var P=new URLSearchParams(window.location.search);function ne(){function t(s){let n=[...P.keys()].find(r=>r.toLowerCase().includes(s));return n&&P.get(n)||""}return{source:t("source").toLowerCase(),campaign:t("campaign").toLowerCase(),medium:t("medium").toLowerCase(),content:t("content").toLowerCase()}}var T=ne(),v=Array.from(P,([t,e])=>`${t.toLowerCase()}: ${e.toLowerCase()}`).join(", ");var k,I,O,j,S={thisUrl:new URL(window.location.href),wfSiteId:(I=(k=document.querySelector("html"))==null?void 0:k.dataset.wfSite)!=null?I:"0000",wfUrl:new URL((j=(O=document.querySelector("html"))==null?void 0:O.dataset.wfSite)!=null?j:"0000","https://webflow.com/api/v1/form/")},x={method:"POST",headers:{"Content-Type":"application/json"},critical:!0},q={webFlow(t){var n;let e=new FormData(t);e.append("UTM",v);let s=new URLSearchParams({name:(n=t==null?void 0:t.getAttribute("name"))!=null?n:"form",source:window.location.href});for(let r of e.entries()){let i=`fields[${r[0]}]`;s.append(i,r[1])}return{...x,url:S.wfUrl.href,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()}},mailChimp(t){var r;let s=b(t,{"given-name":"FNAME","family-name":"LNAME",email:"EMAIL",tel:"PHONE","street-adress":"ADDRESS","postal-code":"POSTALCODE","adress-level2":"REGION",country:"COUNTRY"}),n=new URLSearchParams;for(let[i,p]of s.entries())(typeof p=="string"||typeof p=="number")&&n.append(i,p.toString());return n.append("UTM",v),{...x,url:((r=t.getAttribute("action"))==null?void 0:r.replace("post?","post-json?"))+"&c=?",headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"jsonp",body:n.toString()}},zapier(t){return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({[t.getAttribute("name")||"form"]:Object.fromEntries(new FormData(t)),source:S.thisUrl.hostname+S.thisUrl.pathname,time:new Date().toISOString(),UTM:v})}},amnesty(t){let e=(t==null?void 0:t.getAttribute("data-country-code"))||"";return{...x,url:new URL("amnesty/",E.apiUrl).toString(),body:JSON.stringify({form:{...Object.fromEntries(new FormData(t)),action_id:t.dataset.actionId||"9999",sign_method:t.dataset.signMethod||"agera-default"},UTM:v,site_id:S.wfSiteId,...e?{country_code:e}:{}})}},actionNetwork(t){let e=new FormData(t),s=[];for(let[n,r]of e.entries())n.startsWith("tags")&&s.push(r);return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({person:{given_name:e.get("given-name"),family_name:e.get("family-name"),email_addresses:[{address:e.get("email")}],phone_numbers:[{number:e.get("tel")||""}],postal_addresses:[{postal_code:e.get("postal-code")||"",address_lines:e.get("street-address")||"",region:e.get("adress-level2")||"",country:e.get("country")||""}]},add_tags:[...s],"action_network:referrer_data":{source:T.source?T.source.toString():"",website:S.thisUrl.hostname+S.thisUrl.pathname}})}},profundo:_};function re(t){var l,w,g,f;let e={thisUrl:new URL(window.location.href),wfSiteId:(w=(l=document.querySelector("html"))==null?void 0:l.dataset.wfSite)!=null?w:"0000",wfUrl:new URL((f=(g=document.querySelector("html"))==null?void 0:g.dataset.wfSite)!=null?f:"0000","https://webflow.com/api/v1/form/"),redirect:t.getAttribute("redirect")||null,addUtm:!!t.dataset.redirectUtm||!0,utmSource:new URLSearchParams(window.location.search).get("utm_source")||new URLSearchParams(window.location.search).get("source"),submitButton:t.querySelector('input[type="submit"]'),submitText:"",niceUtms:Array.from(new URLSearchParams(window.location.search),([a,o])=>`${a}: ${o}`).join(", ")};e.submitText=e.submitButton&&e.submitButton.value||"";function s(a,o){let d=new FormData(o);return{method:"POST",headers:{"Content-Type":"application/json"},critical:!1,url:new URL(E.counterPath+a,E.apiUrl).toString(),body:JSON.stringify({form:"default",site_id:e.wfSiteId,last_person:d.get("given-name")||"",form_url:e.thisUrl})}}function n(a,o,d){let h=a.parentNode,y=h==null?void 0:h.querySelector(".w-form-done"),L=h==null?void 0:h.querySelector(".w-form-fail");o?(y&&(y.style.display="block"),L&&(L.style.display="none"),d&&r()):(y&&(y.style.display="none"),L&&(L.style.display="block"),e.submitButton&&(e.submitButton.value=e.submitText))}function r(){if(e.redirect)if(e.addUtm&&e.redirect){let a=new URL(e.redirect,e.thisUrl),o=new URLSearchParams(window.location.search);a.searchParams.forEach((h,y)=>{o.has(y)||o.set(y,h)});let d=a.origin+a.pathname+(o.toString()?"?"+o.toString():"");window.location.href=d}else window.location.href=e.redirect;else console.warn("No redirect defined")}async function i(a){return new Promise((o,d)=>{$.ajax({url:a.url,type:a.method,data:a.body,dataType:"jsonp",success:h=>{o(h)},error:(h,y,L)=>{d(L)}})})}async function p(a){if(a.dataType==="jsonp")return i(a);try{let o=await fetch(a.url,{method:a.method,headers:a.headers,body:a.body});if(!o.ok)throw new Error(`Error fetching ${a.url}: ${o.statusText}`);return o.json()}catch(o){throw console.error("An error occurred:",o),o}}function c(a){let o=[];a.forEach(h=>{if(h.status==="fulfilled"&&h.value){let y=h.value;N(y,o)}});let d=o.reduce((h,y)=>({...h,...y}),{});localStorage.setItem("crm_data",JSON.stringify(d))}async function m(a,o){try{let d=await Promise.allSettled(a.map(y=>p(y))),h=!1;d.forEach((y,L)=>{y.status==="rejected"&&a[L].critical&&(h=!0)}),h?n(o,!1,!1):(c(d),n(o,!0,!0))}catch(d){console.error("Error in Promise.allSettled:",d),n(o,!1,!1)}}async function u(a){a.addEventListener("submit",async function(o){var F;o.preventDefault(),o.stopPropagation(),e.submitButton&&(e.submitButton.value=e.submitButton.dataset.wait||e.submitButton.value);let d=[],h={webflow:"webFlow",actionnetwork:"actionNetwork",mailchimp:"mailChimp",zapier:"zapier",amnesty:"amnesty",profundo:"profundo"},y=((F=a.dataset.crm)==null?void 0:F.toLowerCase())||"webflow",L=a.dataset.counterUpdate;if(y&&h.hasOwnProperty(y)){let te=h[y];d.push(q[te](a))}L&&L!=="default"&&d.push(s(L,a)),d.length>0&&await m(d,a)})}return{handleForm:u}}function V(){let t=document.querySelectorAll("[data-crm]");for(let e of t)re(e).handleForm(e)}var U=class{constructor(){this.counters=new Map}async getCounter(e){if(this.counters.has(e))return this.counters.get(e);let s=new URL(E.counterPath+e,E.apiUrl),n=(async()=>{try{let i=await fetch(s);return i.ok?await i.json():void 0}catch{return}})();this.counters.set(e,n);let r=await n;return this.counters.delete(e),r}},M=new U;async function B(){try{let t=await fetch(E.jsDelivrUrl);return t.ok?`v${(await t.json()).version}`:"latest"}catch{return"latest"}}function oe(){function t(c,m){return c>=m?100:Math.round(c/m*100)}function e(c){let m={350:50,500:100,2e3:250,5e3:500,2e4:2500,5e4:5e3,1e5:1e4,2e5:25e3,5e5:5e4,1e6:1e5},u=25e4,w=Object.keys(m).map(Number).find(f=>f>=c),g=w?m[w]:u;return Math.ceil(c*1.05/g)*g}function s(c,m){return c*1.05<m.target||!m.autoTarget?m.target:e(c)}function n(c,m,u){c.style.width=t(m,u)+"%"}function r(c,m,u){try{let l=new Intl.NumberFormat(u.locale,u.notation).format(m);c.textContent=l}catch{u.notation.useGrouping=!1,u.notation.notation="standard";let l=new Intl.NumberFormat(void 0,u.notation).format(m);c.textContent=l}}function i(c,m,u){m>=u.hideBelow&&(c.style.opacity="1")}async function p(c){var a;let m=c.dataset.counterName||"default",u={target:parseInt(c.dataset.counterTarget||"0",10),hideBelow:parseInt(c.dataset.counterHideBelow||"0"),autoTarget:!!c.dataset.counterAutoTarget||!0,locale:c.dataset.counterLocale||document.documentElement.lang||"undefined",notation:{notation:((a=c.dataset.counterNotation)==null?void 0:a.toLowerCase())||"standard",useGrouping:!0}},l;if(m.toLowerCase()==="default")l=125;else{let o=await M.getCounter(m);o?l=o.count:l=0}if(c.classList.contains("counter-current-value"))r(c,l,u),i(c,l,u);else{let o=c.querySelectorAll(".counter-current-value");for(let d of o)r(d,l,u),i(d,l,u)}let w=s(l,u),g=c.querySelectorAll(".counter-target-value");for(let o of g)r(o,w,u),i(o,l,u);let f=c.querySelectorAll(".counterbar-limiter");for(let o of f)n(o,l,w);i(c,l,u)}return{processCounterElement:p}}function J(){let t=`
      .counter-target-value,
      .counter-current-value,
      .counter_container {
          opacity: 0;
          transition: opacity 0.7s;
      }
  `,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}function z(){let t=document.querySelectorAll("[data-counter-name]"),e=oe();for(let s of t)e.processCounterElement(s)}var A=(t,e=!0)=>t.cloneNode(e);function D(t){t&&t.classList.contains("cloak")&&t.classList.remove("cloak")}function K(){{let t=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: 0;
      padding-top: 0;
      padding-bottom: 0;
		}`,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}}function G(){var c,m;let t=document.querySelectorAll("[data-counter-name]"),s=(m=(c=Array.from(t).find(u=>u.dataset.counterLocale))==null?void 0:c.dataset.counterLocale)!=null?m:document.documentElement.lang||"en";s.toLowerCase()==="none"&&(s=document.documentElement.lang||"en");function n(u,l){let w=A(l),g=w.querySelector('[data-template="last-person-name"]'),f=w.querySelector('[data-template="last-person-time"]');return g&&f&&(g.innerText=u.name,f.innerText=r(u.date,s)),w}function r(u,l){let w=new Date,g=new Date(u),f=new Date(g.getTime()-g.getTimezoneOffset()*6e4),a=Math.floor((w.getTime()-f.getTime())/1e3),o=new Intl.RelativeTimeFormat(l,{numeric:"auto"});if(a<60)return o.format(-a,"second");let d=Math.floor(a/60);if(d<60)return o.format(-d,"minute");let h=Math.floor(a/3600);if(h<12)return o.format(-h,"hour");let y=Math.floor(a/86400);return o.format(-y,"day")}function i(u){let l=u.last_person.names;return l.reverse(),l.filter((g,f,a)=>a.findIndex(o=>o.name===g.name)===f)}async function p(u,l){let w=l.querySelector('[data-template="last-person"]');if(!w)return;let g=w.parentElement;w.remove();let f=await M.getCounter(u);if(!f||!f.last_person||!f.last_person.names||f.last_person.names.length<2){g==null||g.remove();return}let o=i(f).map(d=>n(d,w));o.length>0&&g&&(D(g),g.append(...o)),o.forEach(d=>{setTimeout(function(){D(d)},100)})}t.forEach(u=>{let l=u.dataset.counterName||"default";p(l,u)})}function C(t){let e=JSON.parse(localStorage.getItem(t)||"{}");return Object.entries(e)}function W(){function t(i){let p=C("forwardedform");function c(){let f=localStorage.getItem("crm_data");return f?(localStorage.removeItem("crm_data"),JSON.parse(f)):(localStorage.removeItem("crm_data"),null)}let m=c();m&&m.name_id&&(H(m.name_id),p.push(["name_id",m.name_id.toString()]));function u(f){let a=Array.from(new URLSearchParams(window.location.search),([o,d])=>`${o}: ${d}`).join(", ");return f.find(([o])=>o==="utm")||f.push(["utm",a]),f}let l=u(p);function w(f){f.forEach(([a,o])=>{let d=document.createTextNode(o).textContent,h=`<input type="hidden" id="${a}" name="${a}" value="${d}">`;i.insertAdjacentHTML("afterbegin",h)})}w(l);function g(f){let a="",o=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];f.forEach(([h,y])=>{o.includes(h.toLowerCase())&&(a=y)});let d=document.querySelectorAll("[data-insert-name]");d.length>0&&a!==""&&s(d,a)}g(l)}function e(i){let p=new URLSearchParams(window.location.search),c=Array.from(p,([w,g])=>`${w}: ${g}`),m=i.getAttribute("redirect"),u=m+(m!=null&&m.includes("?")?"&":"?")+p.toString();i.setAttribute("redirect",u),i.setAttribute("data-redirect",u),i.addEventListener("change",()=>{l(i)}),i.addEventListener("input",()=>{l(i)});function l(w){let g=new FormData(w),f=c.join(", ");g.set("utm",f),localStorage.setItem("forwardedform",JSON.stringify(Object.fromEntries(g)))}}function s(i,p){let c={"no-space":p,"leading-space":"&nbsp;"+p,"trailing-space":p+"&nbsp;","double-space":"&nbsp;"+p+"&nbsp;"};i.forEach(m=>{let u=m.getAttribute("data-insert-name")||"leading-space";c.hasOwnProperty(u)&&(m.innerHTML=c[u])})}let n=document.querySelectorAll("[data-crm]");n.length>0&&n.forEach(function(i){e(i)});let r=document.querySelectorAll('[data-load-petition="true"]');r.length>0&&r.forEach(function(i){t(i)})}async function Y(){let t=document.querySelectorAll("[data-js-version]");if(t.length<1)return;let e=document.querySelector('script[src$="agera.js"]'),s="";if(e){let{src:n}=e,r=n.match(/@([^/]+)/);if(r){let[,i]=r;s=i,s.toLowerCase().includes("latest")&&(s=await B())}}s!==""&&t.forEach(n=>{n.innerText=s})}var X="data-insert-name";function ae(t){let e="",s=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];t.forEach(([r,i])=>{s.includes(r.toLowerCase())&&(e=i)});let n=document.querySelectorAll(`[${X}]`);n.length>0&&e!==""&&se(n,e)}function se(t,e){let s={"no-space":e,"leading-space":"&nbsp;"+e,"trailing-space":e+"&nbsp;","double-space":"&nbsp;"+e+"&nbsp;"};t.forEach(n=>{let r=n.getAttribute(X)||"leading-space";s.hasOwnProperty(r)&&(n.innerHTML=s[r])})}function Q(){let t=C("forwardedform");ae(t)}function Z(){let t=new URLSearchParams(window.location.search);document.querySelectorAll("[data-redirect]").forEach(s=>{let n=s.getAttribute("data-redirect");try{if(n){let r=new URL(n,document.baseURI),i=new URL(r.toString()),p=i.searchParams;t.forEach((c,m)=>{p.has(m)||p.set(m,c)}),s.setAttribute("data-redirect",i.toString())}}catch(r){console.error("An error occurred:",r)}})}function ee(){let t=[document.documentElement.lang||"en","en"];document.querySelectorAll("[data-insert-time]").forEach(n=>{n.innerText=ie(n,t)}),document.querySelectorAll("[data-remaining-days-to]").forEach(n=>{n.innerText=ce(n,t)})}function ie(t,e){let s=new Date,n=t.getAttribute("data-insert-time"),r="";if((n==null?void 0:n.toLowerCase())==="year")r=s.getFullYear().toString();else if((n==null?void 0:n.toLowerCase())==="month")r=(s.getMonth()+1).toString();else if((n==null?void 0:n.toLowerCase())==="day")r=s.getDate().toString();else if((n==null?void 0:n.toLowerCase())==="date")r=s.toLocaleDateString(e);else if((n==null?void 0:n.toLowerCase())==="datetime")r=s.toLocaleString(e);else if((n==null?void 0:n.toLowerCase())==="time")r=s.toLocaleTimeString(e);else return"";return r}function ce(t,e){let s=new Date,n=t.getAttribute("data-remaining-days-to");try{if(n){let r=new Date(n),i=Math.round((r.getTime()-s.getTime())/(1e3*60*60*24));return new Intl.RelativeTimeFormat(e,{numeric:"auto"}).format(i,"day")}}catch(r){console.error("remainingDays error:",r)}return""}function me(){J(),K(),document.addEventListener("DOMContentLoaded",()=>{W(),z(),V(),G(),Q(),ee(),Z(),Y()})}window.agera||(window.agera=!0,me());})();
