"use strict";(()=>{function b(t,e){let o=new FormData;for(let[n,r]of new FormData(t))e.hasOwnProperty(n)?o.append(e[n],r):o.append(n,r);return o}var _=new URLSearchParams(window.location.search);function re(){function t(o){let n=[..._.keys()].find(r=>r.toLowerCase().includes(o));return n&&_.get(n)||""}return{source:t("source").toLowerCase(),campaign:t("campaign").toLowerCase(),medium:t("medium").toLowerCase(),content:t("content").toLowerCase()}}var E=re(),v=Array.from(_,([t,e])=>`${t.toLowerCase()}: ${e.toLowerCase()}`).join(", ");var T={apiUrl:"https://utils-api.vercel.app/api/",counterPath:"counter/",jsDelivrUrl:"https://data.jsdelivr.com/v1/packages/gh/ageraplattformen/agera.js/resolved?specifier=latest"},R={method:"POST",headers:{"Content-Type":"application/json"},critical:!0};function H(t){document.querySelectorAll("[data-profundo-client]").forEach(n=>{n.addEventListener("click",async()=>{let r=n.dataset.activitytypeId||"",c=n.dataset.classificationId||"",p=n.dataset.profundoText||"",i=U(void 0,{client:n.dataset.profundoClient||"not_provided",client_url:n.dataset.profundoUrl||"not_provided",country_code:n.dataset.countryCode||"",name:{name_id:Number(t)},register_id:n.dataset.registerId||"",campaign_id:Number(n.dataset.campaignId)||void 0,activity:{...r?{activitytype_id:r}:{activitytype_id:""},...c?{classification_id:c}:{},...p?{shortText:p}:{},shorttext:n.dataset.profundoText||""}});await o(i)})});async function o(n){try{let r=await fetch(n.url,{method:n.method,headers:n.headers,body:n.body});return r.ok?await r.json():void 0}catch(r){console.log("P error: ",r);return}}}function N(t,e){t.data&&e.push(t.data)}function U(t,e){let n=t?b(t,{"given-name":"firstname","family-name":"lastname",email:"email",tel:"mobile","street-adress":"address","postal-code":"zip",country:"country_id"}):void 0,r=e==null?void 0:e.name.name_id;n||(n=new FormData);let c=[];for(let[f,s]of n.entries())if(f.startsWith("infotype")){let a=parseInt(s);isNaN(a)||c.push(a),n.delete(f)}let p=(t==null?void 0:t.getAttribute("data-country-code"))||(e==null?void 0:e.country_code)||"";!(n!=null&&n.get("country"))&&p&&n.append("country",p);let i=(e==null?void 0:e.activity.shorttext)||(t==null?void 0:t.dataset.profundoText),m=(t==null?void 0:t.dataset.registerId)||(e==null?void 0:e.register_id),u=(t==null?void 0:t.dataset.campaignId)||(e==null?void 0:e.campaign_id),l=(t==null?void 0:t.dataset.classificationId)||(e==null?void 0:e.activity.classification_id)||"SI",y=n&&{...Object.fromEntries(n)};r&&(y.name_id=Number(r));let g={...E.campaign?{text1:E.campaign}:"",...E.source?{text2:E.source}:"",...E.medium?{text3:E.medium}:"",...E.content?{text4:E.content}:""};return{...R,critical:!r,url:new URL("profundo/",T.apiUrl).toString(),body:JSON.stringify({client:(t==null?void 0:t.dataset.client)||(e==null?void 0:e.client)||"not_provided",client_url:(t==null?void 0:t.getAttribute("action"))||(e==null?void 0:e.client_url)||"",...p?{country_code:p}:{},referrer:window.location.href,body:{name:y,...m?{register_id:m}:{},...u?{campaign_id:u}:{},...c?{infotype_id:c[0]}:{},activity:{...r?{}:{...g},...i?{shorttext:i}:{},activitytype_id:(t==null?void 0:t.dataset.activitytypeId)||(e==null?void 0:e.activity.activitytype_id)||"UN",...l?{classification_id:l}:{}}}})}}var k,I,O,j,S={thisUrl:new URL(window.location.href),wfSiteId:(I=(k=document.querySelector("html"))==null?void 0:k.dataset.wfSite)!=null?I:"0000",wfUrl:new URL((j=(O=document.querySelector("html"))==null?void 0:O.dataset.wfSite)!=null?j:"0000","https://webflow.com/api/v1/form/")},x={method:"POST",headers:{"Content-Type":"application/json"},critical:!0},q={webFlow(t){var n;let e=new FormData(t);e.append("UTM",v);let o=new URLSearchParams({name:(n=t==null?void 0:t.getAttribute("name"))!=null?n:"form",source:window.location.href});for(let r of e.entries()){let c=`fields[${r[0]}]`;o.append(c,r[1])}return{...x,url:S.wfUrl.href,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()}},mailChimp(t){var r;let o=b(t,{"given-name":"FNAME","family-name":"LNAME",email:"EMAIL",tel:"PHONE","street-adress":"ADDRESS","postal-code":"POSTALCODE","adress-level2":"REGION",country:"COUNTRY"}),n=new URLSearchParams;for(let[c,p]of o.entries())(typeof p=="string"||typeof p=="number")&&n.append(c,p.toString());return n.append("UTM",v),{...x,url:((r=t.getAttribute("action"))==null?void 0:r.replace("post?","post-json?"))+"&c=?",headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"jsonp",body:n.toString()}},zapier(t){return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({[t.getAttribute("name")||"form"]:Object.fromEntries(new FormData(t)),source:S.thisUrl.hostname+S.thisUrl.pathname,time:new Date().toISOString(),UTM:v})}},amnesty(t){let e=(t==null?void 0:t.getAttribute("data-country-code"))||"";return{...x,url:new URL("amnesty/",T.apiUrl).toString(),body:JSON.stringify({form:{...Object.fromEntries(new FormData(t)),action_id:t.dataset.actionId||"9999",sign_method:t.dataset.signMethod||"agera-default"},UTM:v,site_id:S.wfSiteId,...e?{country_code:e}:{}})}},actionNetwork(t){let e=new FormData(t),o=[];for(let[n,r]of e.entries())n.startsWith("tags")&&o.push(r);return{...x,url:t.getAttribute("action")||"",body:JSON.stringify({person:{given_name:e.get("given-name"),family_name:e.get("family-name"),email_addresses:[{address:e.get("email")}],phone_numbers:[{number:e.get("tel")||""}],postal_addresses:[{postal_code:e.get("postal-code")||"",address_lines:e.get("street-address")||"",region:e.get("adress-level2")||"",country:e.get("country")||""}]},add_tags:[...o],"action_network:referrer_data":{source:E.source?E.source.toString():"",website:S.thisUrl.hostname+S.thisUrl.pathname}})}},profundo:U};function oe(t){var l,y,g,f;let e={thisUrl:new URL(window.location.href),wfSiteId:(y=(l=document.querySelector("html"))==null?void 0:l.dataset.wfSite)!=null?y:"0000",wfUrl:new URL((f=(g=document.querySelector("html"))==null?void 0:g.dataset.wfSite)!=null?f:"0000","https://webflow.com/api/v1/form/"),redirect:t.getAttribute("redirect")||null,addUtm:!!t.dataset.redirectUtm||!0,utmSource:new URLSearchParams(window.location.search).get("utm_source")||new URLSearchParams(window.location.search).get("source"),submitButton:t.querySelector('input[type="submit"]'),submitText:"",niceUtms:Array.from(new URLSearchParams(window.location.search),([s,a])=>`${s}: ${a}`).join(", ")};e.submitText=e.submitButton&&e.submitButton.value||"";function o(s,a){let d=new FormData(a);return{method:"POST",headers:{"Content-Type":"application/json"},critical:!1,url:new URL(T.counterPath+s,T.apiUrl).toString(),body:JSON.stringify({form:"default",site_id:e.wfSiteId,last_person:d.get("given-name")||"",form_url:e.thisUrl})}}function n(s,a,d){let h=s.parentNode,w=h==null?void 0:h.querySelector(".w-form-done"),L=h==null?void 0:h.querySelector(".w-form-fail");a?(w&&(w.style.display="block"),L&&(L.style.display="none"),d&&r()):(w&&(w.style.display="none"),L&&(L.style.display="block"),e.submitButton&&(e.submitButton.value=e.submitText))}function r(){if(e.redirect)if(e.addUtm&&e.redirect){let s=new URL(e.redirect,e.thisUrl),a=new URLSearchParams(window.location.search);s.searchParams.forEach((h,w)=>{a.has(w)||a.set(w,h)});let d=s.origin+s.pathname+(a.toString()?"?"+a.toString():"");window.location.href=d}else window.location.href=e.redirect;else console.warn("No redirect defined")}async function c(s){return new Promise((a,d)=>{$.ajax({url:s.url,type:s.method,data:s.body,dataType:"jsonp",success:h=>{a(h)},error:(h,w,L)=>{d(L)}})})}async function p(s){if(s.dataType==="jsonp")return c(s);try{let a=await fetch(s.url,{method:s.method,headers:s.headers,body:s.body});if(!a.ok)throw new Error(`Error fetching ${s.url}: ${a.statusText}`);return a.json()}catch(a){throw console.error("An error occurred:",a),a}}function i(s){let a=[];s.forEach(h=>{if(h.status==="fulfilled"&&h.value){let w=h.value;N(w,a)}});let d=a.reduce((h,w)=>({...h,...w}),{});localStorage.setItem("crm_data",JSON.stringify(d))}async function m(s,a){try{let d=await Promise.allSettled(s.map(w=>p(w))),h=!1;d.forEach((w,L)=>{w.status==="rejected"&&s[L].critical&&(h=!0)}),h?n(a,!1,!1):(i(d),n(a,!0,!0))}catch(d){console.error("Error in Promise.allSettled:",d),n(a,!1,!1)}}async function u(s){s.addEventListener("submit",async function(a){var F;a.preventDefault(),a.stopPropagation(),e.submitButton&&(e.submitButton.value=e.submitButton.dataset.wait||e.submitButton.value);let d=[],h={webflow:"webFlow",actionnetwork:"actionNetwork",mailchimp:"mailChimp",zapier:"zapier",amnesty:"amnesty",profundo:"profundo"},w=((F=s.dataset.crm)==null?void 0:F.toLowerCase())||"webflow",L=s.dataset.counterUpdate;if(w&&h.hasOwnProperty(w)){let ne=h[w];d.push(q[ne](s))}L&&L!=="default"&&d.push(o(L,s)),d.length>0&&await m(d,s)})}return{handleForm:u}}function V(){let t=document.querySelectorAll("[data-crm]");for(let e of t)oe(e).handleForm(e)}var P=class{constructor(){this.counters=new Map}async getCounter(e){if(this.counters.has(e))return this.counters.get(e);let o=new URL(T.counterPath+e,T.apiUrl),n=(async()=>{try{let c=await fetch(o);return c.ok?await c.json():void 0}catch{return}})();this.counters.set(e,n);let r=await n;return this.counters.delete(e),r}},C=new P;async function B(){try{let t=await fetch(T.jsDelivrUrl);return t.ok?`v${(await t.json()).version}`:"latest"}catch{return"latest"}}function ae(){function t(i,m){return i>=m?100:Math.round(i/m*100)}function e(i){let m={350:50,500:100,2e3:250,5e3:500,2e4:2500,5e4:5e3,1e5:1e4,2e5:25e3,5e5:5e4,1e6:1e5},u=25e4,y=Object.keys(m).map(Number).find(f=>f>=i),g=y?m[y]:u;return Math.ceil(i*1.05/g)*g}function o(i,m){return i*1.05<m.target||!m.autoTarget?m.target:e(i)}function n(i,m,u){i.style.width=t(m,u)+"%"}function r(i,m,u){try{let l=new Intl.NumberFormat(u.locale,u.notation).format(m);i.textContent=l}catch{u.notation.useGrouping=!1,u.notation.notation="standard";let l=new Intl.NumberFormat(void 0,u.notation).format(m);i.textContent=l}}function c(i,m,u){m<=u.removeBelow&&(i.style.display="none"),m>=u.hideBelow&&(i.style.opacity="1")}async function p(i){var s;let m=i.dataset.counterName||"default",u={target:parseInt(i.dataset.counterTarget||"0",10),hideBelow:parseInt(i.dataset.counterHideBelow||"0"),removeBelow:parseInt(i.dataset.counterRemoveBelow||"0"),autoTarget:!!i.dataset.counterAutoTarget||!0,locale:i.dataset.counterLocale||document.documentElement.lang||"undefined",notation:{notation:((s=i.dataset.counterNotation)==null?void 0:s.toLowerCase())||"standard",useGrouping:!0}},l;if(m.toLowerCase()==="default")l=125;else{let a=await C.getCounter(m);a?l=a.count:l=0}if(i.classList.contains("counter-current-value"))r(i,l,u),c(i,l,u);else{let a=i.querySelectorAll(".counter-current-value");for(let d of a)r(d,l,u),c(d,l,u)}let y=o(l,u),g=i.querySelectorAll(".counter-target-value");for(let a of g)r(a,y,u),c(a,l,u);let f=i.querySelectorAll(".counterbar-limiter");for(let a of f)n(a,l,y);c(i,l,u)}return{processCounterElement:p}}function J(){let t=`
      .counter-target-value,
      .counter-current-value,
      .counter_container {
          opacity: 0;
          transition: opacity 0.7s;
      }
  `,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}function z(){let t=document.querySelectorAll("[data-counter-name]"),e=ae();for(let o of t)e.processCounterElement(o)}var A=(t,e=!0)=>t.cloneNode(e);function D(t){t&&t.classList.contains("cloak")&&t.classList.remove("cloak")}function K(){{let t=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: 0;
      padding-top: 0;
      padding-bottom: 0;
		}`,e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}}function G(){var i,m;let t=document.querySelectorAll("[data-counter-name]"),o=(m=(i=Array.from(t).find(u=>u.dataset.counterLocale))==null?void 0:i.dataset.counterLocale)!=null?m:document.documentElement.lang||"en";o.toLowerCase()==="none"&&(o=document.documentElement.lang||"en");function n(u,l){let y=A(l),g=y.querySelector('[data-template="last-person-name"]'),f=y.querySelector('[data-template="last-person-time"]');return g&&f&&(g.innerText=u.name,f.innerText=r(u.date,o)),y}function r(u,l){let y=new Date,g=new Date(u),f=new Date(g.getTime()-g.getTimezoneOffset()*6e4),s=Math.floor((y.getTime()-f.getTime())/1e3),a=new Intl.RelativeTimeFormat(l,{numeric:"auto"});if(s<60)return a.format(-s,"second");let d=Math.floor(s/60);if(d<60)return a.format(-d,"minute");let h=Math.floor(s/3600);if(h<12)return a.format(-h,"hour");let w=Math.floor(s/86400);return a.format(-w,"day")}function c(u){let l=u.last_person.names;return l.reverse(),l.filter((g,f,s)=>s.findIndex(a=>a.name===g.name)===f)}async function p(u,l){let y=l.querySelector('[data-template="last-person"]');if(!y)return;let g=y.parentElement;y.remove();let f=await C.getCounter(u);if(!f||!f.last_person||!f.last_person.names||f.last_person.names.length<2){g==null||g.remove();return}let a=c(f).map(d=>n(d,y));a.length>0&&g&&(D(g),g.append(...a)),a.forEach(d=>{setTimeout(function(){D(d)},100)})}t.forEach(u=>{let l=u.dataset.counterName||"default";p(l,u)})}function M(t){let e=JSON.parse(localStorage.getItem(t)||"{}");return Object.entries(e)}function W(){function t(c){let p=M("forwardedform");function i(){let f=localStorage.getItem("crm_data");return f?(localStorage.removeItem("crm_data"),JSON.parse(f)):(localStorage.removeItem("crm_data"),null)}let m=i();m&&m.name_id&&(H(m.name_id),p.push(["name_id",m.name_id.toString()]));function u(f){let s=Array.from(new URLSearchParams(window.location.search),([a,d])=>`${a}: ${d}`).join(", ");return f.find(([a])=>a==="utm")||f.push(["utm",s]),f}let l=u(p);function y(f){f.forEach(([s,a])=>{let d=document.createTextNode(a).textContent,h=`<input type="hidden" id="${s}" name="${s}" value="${d}">`;c.insertAdjacentHTML("afterbegin",h)})}y(l);function g(f){let s="",a=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];f.forEach(([h,w])=>{a.includes(h.toLowerCase())&&(s=w)});let d=document.querySelectorAll("[data-insert-name]");d.length>0&&s!==""&&o(d,s)}g(l)}function e(c){let p=new URLSearchParams(window.location.search),i=Array.from(p,([y,g])=>`${y}: ${g}`),m=c.getAttribute("redirect"),u=m+(m!=null&&m.includes("?")?"&":"?")+p.toString();c.setAttribute("redirect",u),c.setAttribute("data-redirect",u),c.addEventListener("change",()=>{l(c)}),c.addEventListener("input",()=>{l(c)});function l(y){let g=new FormData(y),f=i.join(", ");g.set("utm",f),localStorage.setItem("forwardedform",JSON.stringify(Object.fromEntries(g)))}}function o(c,p){let i={"no-space":p,"leading-space":"&nbsp;"+p,"trailing-space":p+"&nbsp;","double-space":"&nbsp;"+p+"&nbsp;"};c.forEach(m=>{let u=m.getAttribute("data-insert-name")||"leading-space";i.hasOwnProperty(u)&&(m.innerHTML=i[u])})}let n=document.querySelectorAll("[data-crm]");n.length>0&&n.forEach(function(c){e(c)});let r=document.querySelectorAll('[data-load-petition="true"]');r.length>0&&r.forEach(function(c){t(c)})}function Y(){document.querySelectorAll("[data-copy]").forEach(e=>{e.addEventListener("mouseover",function(){e.style.cursor="pointer"}),e.addEventListener("click",async function(){let o="",n=e.getAttribute("data-copy")||"";if((n==null?void 0:n.toLowerCase())==="url")o=window.location.href;else if((n==null?void 0:n.toLowerCase())==="prev-url")o=document.referrer||"";else{let r=document.getElementById(n);r!=null&&r.textContent?o=r.textContent:o=n||""}try{await navigator.clipboard.writeText(o),console.log("Copied to clipboard:",o.toString())}catch(r){console.error("Failed to copy: ",r)}})})}async function X(){let t=document.querySelectorAll("[data-js-version]");if(t.length<1)return;let e=document.querySelector('script[src$="agera.js"]'),o="";if(e){let{src:n}=e,r=n.match(/@([^/]+)/);if(r){let[,c]=r;o=c,o.toLowerCase().includes("latest")&&(o=await B())}}o!==""&&t.forEach(n=>{n.innerText=o})}var Q="data-insert-name";function se(t){let e="",o=["first_name","first-name","firstname","first","fname","f-name","given_name","given-name","givenname","given"];t.forEach(([r,c])=>{o.includes(r.toLowerCase())&&(e=c)});let n=document.querySelectorAll(`[${Q}]`);n.length>0&&e!==""&&ie(n,e)}function ie(t,e){let o={"no-space":e,"leading-space":"&nbsp;"+e,"trailing-space":e+"&nbsp;","double-space":"&nbsp;"+e+"&nbsp;"};t.forEach(n=>{let r=n.getAttribute(Q)||"leading-space";o.hasOwnProperty(r)&&(n.innerHTML=o[r])})}function Z(){let t=M("forwardedform");se(t)}function ee(){let t=new URLSearchParams(window.location.search);document.querySelectorAll("[data-redirect]").forEach(o=>{let n=o.getAttribute("data-redirect");try{if(n){let r=new URL(n,document.baseURI),c=new URL(r.toString()),p=c.searchParams;t.forEach((i,m)=>{p.has(m)||p.set(m,i)}),o.setAttribute("data-redirect",c.toString())}}catch(r){console.error("An error occurred:",r)}})}function te(){let t=[document.documentElement.lang||"en","en"];document.querySelectorAll("[data-insert-time]").forEach(n=>{n.innerText=ce(n,t)}),document.querySelectorAll("[data-remaining-days-to]").forEach(n=>{n.innerText=ue(n,t)})}function ce(t,e){let o=new Date,n=t.getAttribute("data-insert-time"),r="";if((n==null?void 0:n.toLowerCase())==="year")r=o.getFullYear().toString();else if((n==null?void 0:n.toLowerCase())==="month")r=(o.getMonth()+1).toString();else if((n==null?void 0:n.toLowerCase())==="day")r=o.getDate().toString();else if((n==null?void 0:n.toLowerCase())==="date")r=o.toLocaleDateString(e);else if((n==null?void 0:n.toLowerCase())==="datetime")r=o.toLocaleString(e);else if((n==null?void 0:n.toLowerCase())==="time")r=o.toLocaleTimeString(e);else return"";return r}function ue(t,e){let o=new Date,n=t.getAttribute("data-remaining-days-to");try{if(n){let r=new Date(n),c=Math.round((r.getTime()-o.getTime())/(1e3*60*60*24));return new Intl.RelativeTimeFormat(e,{numeric:"auto"}).format(c,"day")}}catch(r){console.error("remainingDays error:",r)}return""}function le(){J(),K(),document.addEventListener("DOMContentLoaded",()=>{W(),z(),V(),G(),Z(),te(),ee(),X(),Y()})}window.agera||(window.agera=!0,le());})();
