"use strict";(()=>{function M(c){c.classList.contains("cloak")&&c.classList.remove("cloak")}function F(){{let c=`.cloak { 
			opacity: 0;
			height: 0px;
      overflow: hidden;
			margin: auto;
		}`,t=document.createElement("style");t.textContent=c,document.head.appendChild(t)}}var S={apiUrl:"https://utils-api.vercel.app/api/",counterPath:"counter/",gitHubUrl:"https://api.github.com/repos/ageraplattformen/agera.js/releases/latest",jsDelivrUrl:"https://data.jsdelivr.com/v1/packages/gh/ageraplattformen/agera.js/resolved?specifier=latest"};var v=class{constructor(){this.counters=new Map}async getCounter(t){if(this.counters.has(t))return this.counters.get(t);let y=new URL(S.counterPath+t,S.apiUrl),h=(async()=>{try{let l=await fetch(y);return l.ok?await l.json():void 0}catch{return}})();this.counters.set(t,h);let L=await h;return this.counters.delete(t),L}},b=new v;async function H(){try{let c=await fetch(S.jsDelivrUrl);return c.ok?`v${(await c.json()).version}`:"latest"}catch{return"latest"}}async function U(){let c=document.querySelectorAll("[data-js-version]");if(c.length<1)return;let t=document.querySelector('script[src$="agera.js"]'),y="";if(t){let{src:h}=t,L=h.match(/@([^/]+)/);if(L){let[,l]=L;y=l,y.toLowerCase().includes("latest")&&(y=await H())}}y!==""&&c.forEach(h=>{h.innerText=y})}function O(c){var s,m,E,d;let t={thisUrl:new URL(window.location.href),wfSiteId:(m=(s=document.querySelector("html"))==null?void 0:s.dataset.wfSite)!=null?m:"0000",wfUrl:new URL((d=(E=document.querySelector("html"))==null?void 0:E.dataset.wfSite)!=null?d:"0000","https://webflow.com/api/v1/form/"),niceUtms:Array.from(new URLSearchParams(window.location.search),([e,n])=>`${e}: ${n}`).join(", "),redirect:c.getAttribute("redirect")||null,endpoint:c.getAttribute("action")||null,addUtm:!!c.dataset.redirectUtm||!0,utmSource:new URLSearchParams(window.location.search).get("utm_source")||new URLSearchParams(window.location.search).get("source"),submitButton:c.querySelector('input[type="submit"]'),submitText:""};t.submitText=t.submitButton&&t.submitButton.value||"";function y(e,n){let f=new FormData;for(let[p,g]of new FormData(e))n.hasOwnProperty(p)?f.append(n[p],g):f.append(p,g);return f}let h={url:t.endpoint||"",method:"POST",headers:{"Content-Type":"application/json"},critical:!0},L={webFlow(e){var p;let n=new FormData(e);n.append("UTM",t.niceUtms);let f=new URLSearchParams({name:(p=e==null?void 0:e.getAttribute("name"))!=null?p:"form",source:window.location.href});for(let g of n.entries()){let T=`fields[${g[0]}]`;f.append(T,g[1])}return{...h,url:t.wfUrl.href,headers:{"Content-Type":"application/x-www-form-urlencoded"},body:f.toString()}},mailChimp(e){var g;let f=y(e,{given_name:"FNAME",family_name:"LNAME",email:"EMAIL",tel:"PHONE",street_adress:"ADDRESS",postal_code:"POSTALCODE",adress_level2:"REGION",country:"COUNTRY"}),p=new URLSearchParams(f);return p.append("UTM",t.niceUtms),{...h,url:((g=t.endpoint)==null?void 0:g.replace("post?","post-json?"))+"&c=?",headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"jsonp",body:p.toString()}},zapier(e){return{...h,body:JSON.stringify({[e.getAttribute("name")||"form"]:Object.fromEntries(new FormData(e)),source:t.thisUrl.hostname+t.thisUrl.pathname,time:new Date().toISOString(),UTM:t.niceUtms})}},amnesty(e){return{...h,url:new URL("amnesty",S.apiUrl).toString(),body:JSON.stringify({form:{...Object.fromEntries(new FormData(e)),action_id:e.dataset.actionId||"9999",sign_method:e.dataset.signMethod||"agera-default"},UTM:t.niceUtms,site_id:t.wfSiteId})}},actionNetwork(e){let n=new FormData(e);return{...h,body:JSON.stringify({person:{given_name:n.get("given-name"),family_name:n.get("family-name"),email_addresses:[{address:n.get("email")}],phone_numbers:[{number:n.get("tel")||""}],postal_addresses:[{postal_code:n.get("postal-code")||"",address_lines:n.get("street-address")||"",region:n.get("adress-level2")||"",country:n.get("country")||""}]},add_tags:[n.getAll("tags")||""],"action_network:referrer_data":{source:t.utmSource?t.utmSource.toString():"",website:t.thisUrl.hostname+t.thisUrl.pathname}})}}};function l(e,n){let f=new FormData(n);return{...h,critical:!1,url:new URL(S.counterPath+e,S.apiUrl).toString(),body:JSON.stringify({form:"default",site_id:t.wfSiteId,last_person:f.get("given-name")||"",source:t.thisUrl})}}function w(e,n,f){let p=e.parentNode,g=p==null?void 0:p.querySelector(".w-form-done"),T=p==null?void 0:p.querySelector(".w-form-fail");n?(g&&(g.style.display="block"),T&&(T.style.display="none"),f&&o()):(g&&(g.style.display="none"),T&&(T.style.display="block"),t.submitButton&&(t.submitButton.value=t.submitText))}function o(){if(t.redirect)if(t.addUtm&&t.redirect){let e=new URL(t.redirect,t.thisUrl),n=new URLSearchParams(window.location.search);e.searchParams.forEach((p,g)=>{n.has(g)||n.set(g,p)});let f=e.origin+e.pathname+(n.toString()?"?"+n.toString():"");window.location.href=f}else window.location.href=t.redirect;else console.warn("No redirect defined")}async function i(e){return await $.ajax({url:e.url,type:e.method,data:e.body,dataType:e.dataType})}async function r(e){let n;if(e.dataType==="jsonp"?n=await i(e):n=await fetch(e.url,{method:e.method,headers:e.headers,body:e.body}),!n.ok)throw new Error(`Error fetching ${e.url}: ${n.statusText}`);return n.json()}async function a(e,n){try{let f=await Promise.allSettled(e.map(g=>r(g))),p=!1;f.forEach((g,T)=>{g.status==="rejected"&&e[T].critical&&(p=!0)}),p?w(n,!1,!1):w(n,!0,!0)}catch(f){console.error("Error in Promise.allSettled:",f),w(n,!1,!1)}}async function u(e){e.addEventListener("submit",async function(n){var C;n.preventDefault(),n.stopPropagation(),t.submitButton&&(t.submitButton.value=t.submitButton.dataset.wait||"Wait...");let f=[],p={webflow:"webFlow",actionnetwork:"actionNetwork",mailchimp:"mailChimp",zapier:"zapier",amnesty:"amnesty"},g=((C=e.dataset.crm)==null?void 0:C.toLowerCase())||"webflow",T=e.dataset.counterUpdate;if(g&&p.hasOwnProperty(g)){let R=p[g];f.push(L[R](e))}T&&T!=="default"&&f.push(l(T,e)),f.length>0&&await a(f,e)})}return{handleForm:u}}function A(){let c=document.querySelectorAll("[data-crm]");for(let t of c)O(t).handleForm(t)}function k(){function c(o,i){return o>=i?100:Math.round(o/i*100)}function t(o){let i={350:50,500:100,2e3:250,5e3:500,2e4:2500,5e4:5e3,1e5:1e4,2e5:25e3,5e5:5e4,1e6:1e5},r=25e4,u=Object.keys(i).map(Number).find(m=>m>=o),s=u?i[u]:r;return Math.ceil(o*1.05/s)*s}function y(o,i){return o*1.05<i.target||!i.autoTarget?i.target:t(o)}function h(o,i,r){o.style.width=c(i,r)+"%"}function L(o,i,r){try{let a=new Intl.NumberFormat(r.locale,r.notation).format(i);o.textContent=a}catch{r.notation.useGrouping=!1,r.notation.notation="standard";let a=new Intl.NumberFormat(void 0,r.notation).format(i);o.textContent=a}}function l(o,i,r){i>=r.hideBelow&&(o.style.opacity="1")}async function w(o){var E;let i=o.dataset.counterName||"default",r={target:parseInt(o.dataset.counterTarget||"0",10),hideBelow:parseInt(o.dataset.counterHideBelow||"0"),autoTarget:!!o.dataset.counterAutoTarget||!0,locale:o.dataset.counterLocale||document.documentElement.lang||"undefined",notation:{notation:((E=o.dataset.counterNotation)==null?void 0:E.toLowerCase())||"standard",useGrouping:!0}},a;if(i.toLowerCase()==="default")a=125;else{let d=await b.getCounter(i);d?a=d.count:a=0}if(o.classList.contains("counter-current-value"))L(o,a,r),l(o,a,r);else{let d=o.querySelectorAll(".counter-current-value");for(let e of d)L(e,a,r),l(e,a,r)}let u=y(a,r),s=o.querySelectorAll(".counter-target-value");for(let d of s)L(d,u,r),l(d,a,r);let m=o.querySelectorAll(".counterbar-limiter");for(let d of m)h(d,a,u);l(o,a,r)}return{processCounterElement:w}}function _(){let c=`
      .counter-target-value,
      .counter-current-value,
      .counter_container {
          opacity: 0;
          transition: opacity 0.7s;
      }
  `,t=document.createElement("style");t.textContent=c,document.head.appendChild(t)}function P(){let c=document.querySelectorAll("[data-counter-name]"),t=k();for(let y of c)t.processCounterElement(y)}var x=(c,t=!0)=>c.cloneNode(t);function D(){var o,i;let c=document.querySelectorAll("[data-counter-name]"),y=(i=(o=Array.from(c).find(r=>r.dataset.counterLocale))==null?void 0:o.dataset.counterLocale)!=null?i:document.documentElement.lang||"en";function h(r,a){let u=x(a),s=u.querySelector('[data-template="last-person-name"]'),m=u.querySelector('[data-template="last-person-time"]');return s&&m&&(s.innerText=r.name,m.innerText=L(r.date,y)),u}function L(r,a){let u=new Date,s=new Date(r),m=new Date(s.getTime()-s.getTimezoneOffset()*6e4),E=Math.floor((u.getTime()-m.getTime())/1e3),d=new Intl.RelativeTimeFormat(a,{numeric:"auto"});if(E<60)return d.format(-E,"second");let e=Math.floor(E/60);if(e<60)return d.format(-e,"minute");let n=Math.floor(E/3600);if(n<12)return d.format(-n,"hour");let f=Math.floor(E/86400);return d.format(-f,"day")}function l(r){let a=r.last_person.names;return a.reverse(),a.filter((s,m,E)=>E.findIndex(d=>d.name===s.name)===m)}async function w(r,a){let u=a.querySelector('[data-template="last-person"]');if(!u)return;let s=u.parentElement;u.remove();let m=await b.getCounter(r);if(!m||!m.last_person||!m.last_person.names||m.last_person.names.length<2){s==null||s.remove();return}let d=l(m).map(e=>h(e,u));d.length>0&&s&&(M(s),s.append(...d)),d.forEach(e=>{setTimeout(function(){M(e)},100)})}c.forEach(r=>{let a=r.dataset.counterName||"default";w(a,r)})}function N(){function c(l,w){let o=new URLSearchParams(window.location.search).toString();l.querySelectorAll("input[data-redirect]").forEach(s=>{let m=s.getAttribute("data-redirect"),E=m+(m!=null&&m.includes("?")?"&":"?")+o.toString();s.setAttribute("data-redirect",E)});let r="",a=["first_name","given_name","fname","first","f-name","first-name","given","given-name","firstname","givenname"];w.forEach(([s,m])=>{let E=document.createTextNode(m).textContent,d=`<input type="hidden" id="${s}" name="${s}" value="${E}">`;l.insertAdjacentHTML("afterbegin",d),a.includes(s.toLowerCase())&&(r=m)});let u=document.querySelectorAll("[data-insert-name]");u.length>0&&r!==""&&y(u,r)}function t(l){let w=new URLSearchParams(window.location.search),o=Array.from(w,([u,s])=>`${u}: ${s}`);localStorage.removeItem("multistepforward");let i=l.getAttribute("redirect"),r=i+(i!=null&&i.includes("?")?"&":"?")+w.toString();l.setAttribute("redirect",r),l.setAttribute("data-redirect",r),l.addEventListener("change",()=>{a(l)}),l.addEventListener("input",()=>{a(l)});function a(u){let s=new FormData(u),m=o.join(", ");s.set("utm",m),localStorage.setItem("forwardedform",JSON.stringify(Object.fromEntries(s)))}}function y(l,w){let o={"no-space":w,"leading-space":"&nbsp;"+w,"trailing-space":w+"&nbsp;","double-space":"&nbsp;"+w+"&nbsp;"};l.forEach(i=>{let r=i.getAttribute("data-insert-name")||"leading-space";o.hasOwnProperty(r)&&(i.innerHTML=o[r])})}let h=document.querySelectorAll("[data-crm]"),L=document.querySelectorAll('[data-load-petition="true"]');h.length>0&&h.forEach(function(l){t(l)}),L.length>0&&localStorage!==null&&L.forEach(function(l){if(localStorage.hasOwnProperty("forwardedform")){let w=JSON.parse(localStorage.getItem("forwardedform")||"{}");c(l,Object.entries(w)),localStorage.removeItem("forwardedform")}})}function j(){F(),_(),document.addEventListener("DOMContentLoaded",()=>{N(),P(),A(),D(),U()})}window.agera||(window.agera=!0,j());})();
